<div class="p-4">
  <div class="row d-flex justify-content-between align-items-center">
    <h3 class="strong-text col-md-11">User search</h3>
    <div class="col-md-1">
      <mat-icon class="col-md-4" (click)="close()">close</mat-icon>
    </div>
  </div>
  <div class="row">
    <h4 class="text-grey col-md-12">
      Search for a user by entering their ID number, user ID, and phone number
    </h4>
  </div>
  <form
    [formGroup]="searchForm"
    (ngSubmit)="search()"
    class="row mt-2 border rounded d-flex justify-content-between align-items-end"
    [ngClass]="hasSearchBeenPerformed() ? 'colored-border' : ''"
  >
    <mat-form-field class="col-md-4" appearance="legacy">
      <mat-select formControlName="criteria">
        <mat-option value="id">ID number</mat-option>
        <mat-option value="name">Name</mat-option>
        <mat-option value="phone">Phone</mat-option>
        <mat-option value="email">Email</mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field class="col-md-8" appearance="legacy">
      <input
        matInput
        [placeholder]="($searchTermPlaceholder | async) || ''"
        formControlName="term"
      />
      <mat-icon
        matSuffix
        (click)="clearSearch()"
        *ngIf="hasSearchBeenPerformed(); else closeIcon"
        >close</mat-icon
      >
      <ng-template #closeIcon>
        <mat-icon matSuffix (click)="search()">search</mat-icon>
      </ng-template>
    </mat-form-field>
  </form>

  <div class="row mt-2 border rounded" [hidden]="!hasSearchBeenPerformed()">
    <table mat-table [dataSource]="dataSource" matSort>
      <ng-container matColumnDef="select">
        <th mat-header-cell *matHeaderCellDef>
          <mat-checkbox
            (change)="$event ? masterToggle() : null"
            [checked]="selection.hasValue() && isAllSelected()"
            [indeterminate]="selection.hasValue() && !isAllSelected()"
          >
          </mat-checkbox>
        </th>
        <td mat-cell *matCellDef="let row">
          <mat-checkbox
            (click)="$event.stopPropagation()"
            (change)="$event ? selection.toggle(row) : null"
            [checked]="selection.isSelected(row)"
          >
          </mat-checkbox>
        </td>
      </ng-container>

      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>User ID</th>
        <td mat-cell *matCellDef="let row">{{ row.id }}</td>
      </ng-container>

      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>
        <td mat-cell *matCellDef="let row">{{ row.name }}</td>
      </ng-container>

      <ng-container matColumnDef="phone">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Phone</th>
        <td mat-cell *matCellDef="let row">{{ row.phone }}</td>
      </ng-container>

      <ng-container matColumnDef="email">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Email</th>
        <td mat-cell *matCellDef="let row">{{ row.email }}</td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
        <td
          mat-cell
          *matCellDef="let row"
          class="status"
          [ngClass]="{
            enabled: row.status === 'enabled',
            disabled: row.status === 'disabled'
          }"
        >
          {{ row.status }}
        </td>
      </ng-container>

      <ng-container matColumnDef="disclaimer">
        <td class="footer" mat-footer-cell *matFooterCellDef colspan="6">
          {{ selection.selected.length }} of
          {{ dataSource.filteredData.length }} items
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      <tr mat-footer-row *matFooterRowDef="['disclaimer']"></tr>
    </table>
  </div>

  <div class="row d-flex justify-content-between">
    <div class="col-md-4">
      <button
        mat-raised-button
        color="secundary"
        class="mt-5 col-md-12"
        (click)="close()"
      >
        Cancel
      </button>
    </div>
    <div class="col-md-4">
      <button
        mat-raised-button
        color="secundary"
        class="mt-5 col-md-12"
        (click)="search()"
        *ngIf="isNothingSelected(); else continueButton"
      >
        Search
      </button>
      <ng-template #continueButton>
        <button
          mat-raised-button
          color="primary"
          class="mt-5 col-md-12"
          (click)="continue()"
        >
          Continue
        </button>
      </ng-template>
    </div>
  </div>
</div>
